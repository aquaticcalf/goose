<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Donut & Pie Charts</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            min-height: 600px;
        }
        
        .controls {
            width: 350px;
            padding: 30px;
            background-color: #fafbfc;
            border-right: 1px solid #e1e8ed;
        }
        
        .visualization {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .chart-type-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .chart-type-btn {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .chart-type-btn.active {
            background: #667eea;
            color: white;
        }
        
        .chart-type-btn:hover {
            background: #5a6fd8;
            color: white;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            background-color: #fff;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .sample-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .sample-btn {
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .sample-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .update-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .update-btn:hover {
            transform: translateY(-2px);
        }
        
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        #chart {
            width: 100%;
            height: 500px;
        }
        
        .slice {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .slice:hover {
            filter: brightness(1.1);
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            max-width: 600px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        
        .chart-stats {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Interactive Donut & Pie Charts</h1>
            <p>Visualize categorical data with interactive donut and pie charts</p>
        </div>
        
        <div class="content">
            <div class="controls">
                <div class="control-group">
                    <label>Chart Type:</label>
                    <div class="chart-type-controls">
                        <button class="chart-type-btn active" data-type="donut">Donut</button>
                        <button class="chart-type-btn" data-type="pie">Pie</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="dataInput">Data (JSON):</label>
                    <textarea id="dataInput" placeholder="Enter your data in JSON format..."></textarea>
                    <div class="sample-buttons">
                        <button class="sample-btn" data-sample="budget">Budget</button>
                        <button class="sample-btn" data-sample="sales">Sales</button>
                        <button class="sample-btn" data-sample="demographics">Demographics</button>
                        <button class="sample-btn" data-sample="expenses">Expenses</button>
                        <button class="sample-btn" data-sample="traffic">Traffic</button>
                    </div>
                </div>
                
                <button class="update-btn" onclick="updateChart()">Update Chart</button>
                
                <div id="error-message"></div>
            </div>
            
            <div class="visualization">
                <div id="chart"></div>
                <div class="legend" id="legend"></div>
                <div class="chart-stats" id="stats"></div>
            </div>
        </div>
    </div>

    <script>
        // Sample data sets
        const sampleData = {
            budget: [
                { label: "Marketing", value: 25000, color: "#FF6B6B" },
                { label: "Development", value: 35000, color: "#4ECDC4" },
                { label: "Operations", value: 20000, color: "#45B7D1" },
                { label: "Sales", value: 15000, color: "#96CEB4" },
                { label: "HR", value: 10000, color: "#FFEAA7" },
                { label: "Legal", value: 5000, color: "#DDA0DD" }
            ],
            sales: [
                { label: "Q1", value: 120000, color: "#FF7675" },
                { label: "Q2", value: 150000, color: "#74B9FF" },
                { label: "Q3", value: 180000, color: "#00B894" },
                { label: "Q4", value: 200000, color: "#FDCB6E" }
            ],
            demographics: [
                { label: "18-25", value: 2500, color: "#E17055" },
                { label: "26-35", value: 4200, color: "#0984E3" },
                { label: "36-45", value: 3800, color: "#00B894" },
                { label: "46-55", value: 2900, color: "#FDCB6E" },
                { label: "56-65", value: 1800, color: "#6C5CE7" },
                { label: "65+", value: 1200, color: "#A29BFE" }
            ],
            expenses: [
                { label: "Rent", value: 3000, color: "#FF7675" },
                { label: "Utilities", value: 500, color: "#74B9FF" },
                { label: "Food", value: 800, color: "#00B894" },
                { label: "Transportation", value: 400, color: "#FDCB6E" },
                { label: "Entertainment", value: 300, color: "#6C5CE7" },
                { label: "Healthcare", value: 600, color: "#FD79A8" },
                { label: "Savings", value: 1000, color: "#00CEC9" }
            ],
            traffic: [
                { label: "Organic Search", value: 45000, color: "#00B894" },
                { label: "Direct", value: 25000, color: "#0984E3" },
                { label: "Social Media", value: 15000, color: "#E17055" },
                { label: "Referral", value: 8000, color: "#FDCB6E" },
                { label: "Email", value: 5000, color: "#6C5CE7" },
                { label: "Paid Ads", value: 12000, color: "#FD79A8" }
            ]
        };

        // Chart configuration
        let currentChartType = 'donut';
        let currentData = sampleData.budget;
        
        // Chart dimensions
        const width = 400;
        const height = 400;
        const radius = Math.min(width, height) / 2;
        
        // Create SVG
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
            
        const g = svg.append("g")
            .attr("transform", `translate(${width / 2}, ${height / 2})`);
            
        // Create tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Initialize with sample data
        document.getElementById('dataInput').value = JSON.stringify(currentData, null, 2);
        
        // Event listeners
        document.querySelectorAll('.chart-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentChartType = this.dataset.type;
                updateChart();
            });
        });
        
        document.querySelectorAll('.sample-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sample = sampleData[this.dataset.sample];
                document.getElementById('dataInput').value = JSON.stringify(sample, null, 2);
                updateChart();
            });
        });

        function updateChart() {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = '';
            
            try {
                const inputData = JSON.parse(document.getElementById('dataInput').value);
                
                // Validate data format
                if (!Array.isArray(inputData)) {
                    throw new Error('Data must be an array');
                }
                
                for (let item of inputData) {
                    if (!item.label || typeof item.value !== 'number') {
                        throw new Error('Each item must have "label" and "value" properties');
                    }
                }
                
                currentData = inputData;
                renderChart();
                updateLegend();
                updateStats();
                
            } catch (error) {
                errorDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function renderChart() {
            // Clear previous chart
            g.selectAll("*").remove();
            
            // Create pie layout
            const pie = d3.pie()
                .value(d => d.value)
                .sort(null);
                
            // Create arc generator
            const outerRadius = radius - 10;
            const innerRadius = currentChartType === 'donut' ? radius * 0.4 : 0;
            
            const arc = d3.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius);
                
            const hoverArc = d3.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius + 10);
            
            // Generate pie data
            const pieData = pie(currentData);
            
            // Create slices
            const slices = g.selectAll(".slice")
                .data(pieData)
                .enter()
                .append("g")
                .attr("class", "slice");
                
            // Add paths
            slices.append("path")
                .attr("d", arc)
                .attr("fill", d => d.data.color || getDefaultColor(d.index))
                .style("stroke", "white")
                .style("stroke-width", "2px")
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr("d", hoverArc);
                        
                    const percentage = ((d.value / d3.sum(currentData, d => d.value)) * 100).toFixed(1);
                    
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                        
                    tooltip.html(`
                        <strong>${d.data.label}</strong><br/>
                        Value: ${d.data.value.toLocaleString()}<br/>
                        Percentage: ${percentage}%
                    `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(event, d) {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr("d", arc);
                        
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .on("click", function(event, d) {
                    console.log("Clicked:", d.data);
                });
                
            // Add labels for pie chart
            if (currentChartType === 'pie') {
                const labelArc = d3.arc()
                    .innerRadius(outerRadius * 0.6)
                    .outerRadius(outerRadius * 0.6);
                    
                slices.append("text")
                    .attr("transform", d => `translate(${labelArc.centroid(d)})`)
                    .attr("dy", "0.35em")
                    .style("text-anchor", "middle")
                    .style("font-size", "12px")
                    .style("font-weight", "bold")
                    .style("fill", "white")
                    .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.7)")
                    .text(d => {
                        const percentage = ((d.value / d3.sum(currentData, d => d.value)) * 100);
                        return percentage > 5 ? `${percentage.toFixed(0)}%` : '';
                    });
            }
            
            // Add center text for donut chart
            if (currentChartType === 'donut') {
                const total = d3.sum(currentData, d => d.value);
                
                g.append("text")
                    .attr("text-anchor", "middle")
                    .attr("dy", "-0.5em")
                    .style("font-size", "24px")
                    .style("font-weight", "bold")
                    .style("fill", "#333")
                    .text(total.toLocaleString());
                    
                g.append("text")
                    .attr("text-anchor", "middle")
                    .attr("dy", "1em")
                    .style("font-size", "14px")
                    .style("fill", "#666")
                    .text("Total");
            }
            
            // Animate slices
            slices.select("path")
                .style("opacity", 0)
                .transition()
                .duration(800)
                .style("opacity", 1)
                .attrTween("d", function(d) {
                    const interpolate = d3.interpolate({startAngle: 0, endAngle: 0}, d);
                    return function(t) {
                        return arc(interpolate(t));
                    };
                });
        }

        function updateLegend() {
            const legend = d3.select("#legend");
            legend.selectAll("*").remove();
            
            const legendItems = legend.selectAll(".legend-item")
                .data(currentData)
                .enter()
                .append("div")
                .attr("class", "legend-item");
                
            legendItems.append("div")
                .attr("class", "legend-color")
                .style("background-color", d => d.color || getDefaultColor(currentData.indexOf(d)));
                
            legendItems.append("span")
                .text(d => `${d.label} (${d.value.toLocaleString()})`);
        }

        function updateStats() {
            const total = d3.sum(currentData, d => d.value);
            const count = currentData.length;
            const average = total / count;
            const max = d3.max(currentData, d => d.value);
            const min = d3.min(currentData, d => d.value);
            
            document.getElementById('stats').innerHTML = `
                <strong>Statistics:</strong> 
                Total: ${total.toLocaleString()} | 
                Categories: ${count} | 
                Average: ${average.toLocaleString()} | 
                Max: ${max.toLocaleString()} | 
                Min: ${min.toLocaleString()}
            `;
        }

        function getDefaultColor(index) {
            const colors = [
                "#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", "#FFEAA7", 
                "#DDA0DD", "#FF7675", "#74B9FF", "#00B894", "#FDCB6E",
                "#6C5CE7", "#FD79A8", "#00CEC9", "#E17055", "#A29BFE"
            ];
            return colors[index % colors.length];
        }

        // Initial render
        updateChart();
    </script>
</body>
</html>
