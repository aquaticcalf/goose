<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map Visualization</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            min-height: 700px;
        }
        
        .controls {
            width: 350px;
            padding: 30px;
            background-color: #fafbfc;
            border-right: 1px solid #e1e8ed;
        }
        
        .visualization {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .viz-type-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .viz-type-btn {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .viz-type-btn.active {
            background: #667eea;
            color: white;
        }
        
        .viz-type-btn:hover {
            background: #5a6fd8;
            color: white;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            background-color: #fff;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .sample-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .sample-btn {
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .sample-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .update-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .update-btn:hover {
            transform: translateY(-2px);
        }
        
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        #map {
            width: 100%;
            height: 600px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .map-stats {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        
        .custom-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .custom-popup h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .custom-popup p {
            margin: 5px 0;
            color: #666;
        }
        
        .marker-cluster-small {
            background-color: rgba(181, 226, 140, 0.6);
        }
        
        .marker-cluster-small div {
            background-color: rgba(110, 204, 57, 0.6);
        }
        
        .marker-cluster-medium {
            background-color: rgba(241, 211, 87, 0.6);
        }
        
        .marker-cluster-medium div {
            background-color: rgba(240, 194, 12, 0.6);
        }
        
        .marker-cluster-large {
            background-color: rgba(253, 156, 115, 0.6);
        }
        
        .marker-cluster-large div {
            background-color: rgba(241, 128, 23, 0.6);
        }
        
        .leaflet-control-layers {
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Interactive Map Visualization</h1>
            <p>Visualize geographic data with location pins</p>
        </div>
        
        <div class="content">
            <div class="controls">

                
                <div class="control-group">
                    <label for="dataInput">Data (JSON):</label>
                    <textarea id="dataInput" placeholder="Enter your geographic data in JSON format..."></textarea>
                    <div class="sample-buttons">
                        <button class="sample-btn" data-sample="cities">World Cities</button>
                        <button class="sample-btn" data-sample="stores">Store Locations</button>
                        <button class="sample-btn" data-sample="earthquakes">Earthquakes</button>
                        <button class="sample-btn" data-sample="restaurants">Restaurants</button>
                        <button class="sample-btn" data-sample="events">Events</button>
                    </div>
                </div>
                
                <button class="update-btn" onclick="updateMap()">Update Map</button>
                
                <div id="error-message"></div>
            </div>
            
            <div class="visualization">
                <div id="map"></div>
                <div class="map-stats" id="stats"></div>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    

    
    <!-- Leaflet MarkerCluster Plugin -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <script>
        // Sample data sets
        const sampleData = {
            cities: [
                { lat: 40.7128, lng: -74.0060, name: "New York", value: 8400000, description: "The Big Apple" },
                { lat: 34.0522, lng: -118.2437, name: "Los Angeles", value: 3900000, description: "City of Angels" },
                { lat: 41.8781, lng: -87.6298, name: "Chicago", value: 2700000, description: "Windy City" },
                { lat: 29.7604, lng: -95.3698, name: "Houston", value: 2300000, description: "Space City" },
                { lat: 33.4484, lng: -112.0740, name: "Phoenix", value: 1600000, description: "Valley of the Sun" },
                { lat: 39.9526, lng: -75.1652, name: "Philadelphia", value: 1580000, description: "City of Brotherly Love" },
                { lat: 29.4241, lng: -98.4936, name: "San Antonio", value: 1530000, description: "Alamo City" },
                { lat: 32.7767, lng: -96.7970, name: "Dallas", value: 1340000, description: "Big D" },
                { lat: 37.7749, lng: -122.4194, name: "San Francisco", value: 870000, description: "Golden Gate City" },
                { lat: 25.7617, lng: -80.1918, name: "Miami", value: 470000, description: "Magic City" }
            ],
            stores: [
                { lat: 37.7749, lng: -122.4194, name: "SF Downtown Store", value: 150000, description: "Flagship location" },
                { lat: 37.7849, lng: -122.4094, name: "SF Union Square", value: 120000, description: "High traffic area" },
                { lat: 37.7649, lng: -122.4294, name: "SF Mission District", value: 95000, description: "Local community store" },
                { lat: 40.7589, lng: -73.9851, name: "NYC Times Square", value: 200000, description: "Tourist hotspot" },
                { lat: 40.7505, lng: -73.9934, name: "NYC SoHo", value: 180000, description: "Fashion district" },
                { lat: 40.7282, lng: -74.0776, name: "NYC Brooklyn", value: 110000, description: "Emerging market" },
                { lat: 34.0522, lng: -118.2437, name: "LA Downtown", value: 140000, description: "Business district" },
                { lat: 34.0736, lng: -118.4004, name: "LA Santa Monica", value: 160000, description: "Beach location" },
                { lat: 34.0928, lng: -118.3287, name: "LA Hollywood", value: 130000, description: "Entertainment hub" }
            ],
            earthquakes: [
                { lat: 35.6762, lng: 139.6503, name: "Tokyo Earthquake", value: 7.2, description: "Major seismic event" },
                { lat: 37.7749, lng: -122.4194, name: "San Francisco Quake", value: 6.8, description: "Fault line activity" },
                { lat: -33.8688, lng: 151.2093, name: "Sydney Tremor", value: 5.1, description: "Minor earthquake" },
                { lat: 41.9028, lng: 12.4964, name: "Rome Earthquake", value: 6.2, description: "Historical region" },
                { lat: 39.9042, lng: 116.4074, name: "Beijing Quake", value: 5.8, description: "Tectonic movement" },
                { lat: -22.9068, lng: -43.1729, name: "Rio Tremor", value: 4.9, description: "Coastal activity" },
                { lat: 19.4326, lng: -99.1332, name: "Mexico City Quake", value: 7.1, description: "Ring of Fire" },
                { lat: -6.2088, lng: 106.8456, name: "Jakarta Earthquake", value: 6.5, description: "Island nation seismic" },
                { lat: 28.7041, lng: 77.1025, name: "Delhi Tremor", value: 5.3, description: "Continental plate" }
            ],
            restaurants: [
                { lat: 40.7614, lng: -73.9776, name: "Le Bernardin", value: 95, description: "Michelin 3-star seafood" },
                { lat: 40.7505, lng: -73.9934, name: "Eleven Madison Park", value: 92, description: "Fine dining experience" },
                { lat: 37.7749, lng: -122.4194, name: "Atelier Crenn", value: 90, description: "Artistic French cuisine" },
                { lat: 41.8781, lng: -87.6298, name: "Alinea", value: 94, description: "Molecular gastronomy" },
                { lat: 34.0522, lng: -118.2437, name: "Providence", value: 88, description: "Seafood excellence" },
                { lat: 25.7617, lng: -80.1918, name: "Joe's Stone Crab", value: 85, description: "Miami institution" },
                { lat: 29.9511, lng: -90.0715, name: "Commander's Palace", value: 87, description: "New Orleans classic" },
                { lat: 47.6062, lng: -122.3321, name: "Canlis", value: 89, description: "Pacific Northwest" },
                { lat: 42.3601, lng: -71.0589, name: "Oleana", value: 86, description: "Mediterranean flavors" }
            ],
            events: [
                { lat: 40.7589, lng: -73.9851, name: "Tech Conference 2024", value: 5000, description: "Annual technology summit" },
                { lat: 37.7749, lng: -122.4194, name: "Music Festival", value: 15000, description: "Three-day outdoor concert" },
                { lat: 34.0522, lng: -118.2437, name: "Film Premiere", value: 800, description: "Hollywood red carpet event" },
                { lat: 41.8781, lng: -87.6298, name: "Food & Wine Expo", value: 3200, description: "Culinary celebration" },
                { lat: 25.7617, lng: -80.1918, name: "Art Basel", value: 12000, description: "International art fair" },
                { lat: 42.3601, lng: -71.0589, name: "Marathon", value: 25000, description: "Annual city marathon" },
                { lat: 39.7392, lng: -104.9903, name: "Comic Convention", value: 8000, description: "Pop culture gathering" },
                { lat: 47.6062, lng: -122.3321, name: "Startup Pitch Day", value: 500, description: "Entrepreneur showcase" }
            ]
        };

        // Map configuration
        let map;
        let currentData = sampleData.cities;
        let markersLayer;
        let markerClusterGroup;
        
        // Initialize map
        function initMap() {
            map = L.map('map').setView([39.8283, -98.5795], 4); // Center on USA
            
            // Add tile layers
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            });
            
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '© Esri, © OpenStreetMap contributors',
                maxZoom: 18
            });
            
            const topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenTopoMap contributors',
                maxZoom: 17
            });
            
            // Add default layer
            osmLayer.addTo(map);
            
            // Layer control
            const baseLayers = {
                "OpenStreetMap": osmLayer,
                "Satellite": satelliteLayer,
                "Topographic": topoLayer
            };
            
            L.control.layers(baseLayers).addTo(map);
            
            // Initialize marker cluster group
            markerClusterGroup = L.markerClusterGroup({
                chunkedLoading: true,
                maxClusterRadius: 50
            });
        }
        
        // Initialize with sample data
        document.getElementById('dataInput').value = JSON.stringify(currentData, null, 2);
        
        // Event listeners
        
        document.querySelectorAll('.sample-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sample = sampleData[this.dataset.sample];
                document.getElementById('dataInput').value = JSON.stringify(sample, null, 2);
                updateMap();
            });
        });

        function updateMap() {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = '';
            
            try {
                const inputData = JSON.parse(document.getElementById('dataInput').value);
                
                // Validate data format
                if (!Array.isArray(inputData)) {
                    throw new Error('Data must be an array');
                }
                
                for (let item of inputData) {
                    if (typeof item.lat !== 'number' || typeof item.lng !== 'number') {
                        throw new Error('Each item must have numeric "lat" and "lng" properties');
                    }
                    if (!item.name) {
                        throw new Error('Each item must have a "name" property');
                    }
                }
                
                currentData = inputData;
                renderVisualization();
                updateStats();
                
            } catch (error) {
                errorDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function renderVisualization() {
            // Clear existing layers
            if (markersLayer) {
                map.removeLayer(markersLayer);
            }
            if (markerClusterGroup) {
                markerClusterGroup.clearLayers();
                map.removeLayer(markerClusterGroup);
            }
            
            renderMarkers();
            
            // Fit map to data bounds
            if (currentData.length > 0) {
                const group = new L.featureGroup(currentData.map(d => L.marker([d.lat, d.lng])));
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function renderMarkers() {
            markerClusterGroup = L.markerClusterGroup({
                chunkedLoading: true,
                maxClusterRadius: 50,
                iconCreateFunction: function(cluster) {
                    const count = cluster.getChildCount();
                    let className = 'marker-cluster-small';
                    
                    if (count > 10) {
                        className = 'marker-cluster-medium';
                    }
                    if (count > 100) {
                        className = 'marker-cluster-large';
                    }
                    
                    return new L.DivIcon({
                        html: '<div><span>' + count + '</span></div>',
                        className: 'marker-cluster ' + className,
                        iconSize: new L.Point(40, 40)
                    });
                }
            });
            
            currentData.forEach(point => {
                // Create custom icon based on value
                const value = point.value || 1;
                const maxValue = Math.max(...currentData.map(d => d.value || 1));
                const size = Math.max(10, Math.min(30, (value / maxValue) * 30));
                const color = getColorByValue(value, maxValue);
                
                const customIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="
                        background-color: ${color};
                        width: ${size}px;
                        height: ${size}px;
                        border-radius: 50%;
                        border: 2px solid white;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: ${Math.max(8, size * 0.4)}px;
                    ">${value > 1000 ? Math.round(value/1000) + 'k' : value}</div>`,
                    iconSize: [size, size],
                    iconAnchor: [size/2, size/2]
                });
                
                const marker = L.marker([point.lat, point.lng], { icon: customIcon });
                
                // Create popup content
                const popupContent = `
                    <div class="custom-popup">
                        <h3>${point.name}</h3>
                        <p><strong>Value:</strong> ${(point.value || 0).toLocaleString()}</p>
                        <p><strong>Location:</strong> ${point.lat.toFixed(4)}, ${point.lng.toFixed(4)}</p>
                        ${point.description ? `<p><strong>Description:</strong> ${point.description}</p>` : ''}
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                markerClusterGroup.addLayer(marker);
            });
            
            map.addLayer(markerClusterGroup);
        }



        function getColorByValue(value, maxValue) {
            const ratio = value / maxValue;
            if (ratio > 0.8) return '#d73027';
            if (ratio > 0.6) return '#f46d43';
            if (ratio > 0.4) return '#fdae61';
            if (ratio > 0.2) return '#74add1';
            return '#4575b4';
        }

        function updateStats() {
            const totalPoints = currentData.length;
            const totalValue = currentData.reduce((sum, d) => sum + (d.value || 0), 0);
            const avgValue = totalValue / totalPoints;
            const maxValue = Math.max(...currentData.map(d => d.value || 0));
            const minValue = Math.min(...currentData.map(d => d.value || 0));
            
            // Calculate geographic bounds
            const lats = currentData.map(d => d.lat);
            const lngs = currentData.map(d => d.lng);
            const latRange = Math.max(...lats) - Math.min(...lats);
            const lngRange = Math.max(...lngs) - Math.min(...lngs);
            
            document.getElementById('stats').innerHTML = `
                <strong>Statistics:</strong> 
                Points: ${totalPoints} | 
                Total Value: ${totalValue.toLocaleString()} | 
                Average: ${avgValue.toFixed(0)} | 
                Range: ${minValue}-${maxValue} | 
                Geographic Span: ${latRange.toFixed(2)}° × ${lngRange.toFixed(2)}°
            `;
        }

        // Initialize everything when page loads
        window.addEventListener('load', function() {
            initMap();
            updateMap();
        });
    </script>
</body>
</html>
