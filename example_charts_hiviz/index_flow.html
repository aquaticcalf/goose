<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Flowchart Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .content {
            display: flex;
            min-height: 600px;
        }

        .chart-container {
            flex: 1;
            padding: 30px;
            background: white;
            position: relative;
        }

        #flowchart {
            width: 100%;
            height: 600px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #fafafa;
        }

        .info-panel {
            width: 300px;
            background: #f8f9fa;
            padding: 30px;
            border-left: 1px solid #e9ecef;
        }

        .info-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .info-section h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 500;
        }

        .stat-value {
            color: #495057;
            font-weight: 600;
        }

        .description {
            color: #6c757d;
            line-height: 1.6;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }

        .legend-label {
            color: #495057;
            font-size: 14px;
        }

        /* D3 Flowchart Styles */
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            transform: scale(1.05);
        }

        .node-rect {
            stroke: #333;
            stroke-width: 2;
            rx: 8;
            ry: 8;
        }

        .node-diamond {
            stroke: #333;
            stroke-width: 2;
        }

        .node-circle {
            stroke: #333;
            stroke-width: 2;
        }

        .node-text {
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            font-weight: 500;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: #333;
            pointer-events: none;
        }

        .link {
            fill: none;
            stroke: #666;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        .link-label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 10px;
            fill: #666;
            text-anchor: middle;
            background: white;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .info-panel {
                width: 100%;
            }
            
            .button-group {
                justify-content: center;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Interactive Flowchart Visualization</h1>
            <p>Explore various flowchart types with dynamic data and interactive controls</p>
        </div>

        <div class="controls">
            <div class="control-section">
                <h3>ðŸ“Š Sample Flowcharts</h3>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="loadSampleData('process')">Business Process</button>
                    <button class="btn btn-primary" onclick="loadSampleData('decision')">Decision Tree</button>
                    <button class="btn btn-primary" onclick="loadSampleData('workflow')">Software Workflow</button>
                    <button class="btn btn-primary" onclick="loadSampleData('simple')">Simple Flow</button>
                </div>
            </div>

            <div class="control-section">
                <h3>âš¡ Actions</h3>
                <div class="button-group">
                    <button class="btn btn-success" onclick="randomizeData()">Randomize</button>
                    <button class="btn btn-success" onclick="addRandomNode()">Add Node</button>
                    <button class="btn btn-success" onclick="exportChart()">Export SVG</button>
                    <button class="btn btn-success" onclick="resetZoom()">Reset View</button>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="chart-container">
                <svg id="flowchart"></svg>
            </div>

            <div class="info-panel">
                <div class="info-section">
                    <h4>ðŸ“ˆ Chart Statistics</h4>
                    <div class="stat-item">
                        <span class="stat-label">Nodes:</span>
                        <span class="stat-value" id="nodeCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Connections:</span>
                        <span class="stat-value" id="connectionCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Chart Type:</span>
                        <span class="stat-value" id="chartType">Flowchart</span>
                    </div>
                </div>

                <div class="info-section">
                    <h4>ðŸŽ¯ Current Dataset</h4>
                    <p class="description" id="datasetDescription">
                        Select a sample flowchart to see detailed information about the current visualization.
                    </p>
                </div>

                <div class="info-section">
                    <h4>ðŸ”§ Node Types</h4>
                    <div id="nodeLegend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4facfe;"></div>
                            <span class="legend-label">Process</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f093fb;"></div>
                            <span class="legend-label">Decision</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #43e97b;"></div>
                            <span class="legend-label">Start/End</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fa709a;"></div>
                            <span class="legend-label">Data/Input</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h4>ðŸ’¡ Features</h4>
                    <ul style="color: #6c757d; font-size: 14px; line-height: 1.6;">
                        <li>Interactive D3.js flowcharts</li>
                        <li>Drag and zoom functionality</li>
                        <li>Multiple node types</li>
                        <li>Dynamic data management</li>
                        <li>Export to SVG</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let svg, g, zoom;
        let currentData = null;
        let nodeCounter = 0;

        // Sample data sets
        const sampleData = {
            simple: {
                name: 'Simple Flow',
                description: 'A basic flowchart showing a simple process with start, process, decision, and end nodes.',
                nodes: [
                    { id: 'start', label: 'Start', type: 'start', x: 200, y: 50 },
                    { id: 'process1', label: 'Process Data', type: 'process', x: 200, y: 150 },
                    { id: 'decision1', label: 'Valid?', type: 'decision', x: 200, y: 250 },
                    { id: 'process2', label: 'Save Data', type: 'process', x: 350, y: 350 },
                    { id: 'process3', label: 'Show Error', type: 'process', x: 50, y: 350 },
                    { id: 'end', label: 'End', type: 'end', x: 200, y: 450 }
                ],
                links: [
                    { source: 'start', target: 'process1' },
                    { source: 'process1', target: 'decision1' },
                    { source: 'decision1', target: 'process2', label: 'Yes' },
                    { source: 'decision1', target: 'process3', label: 'No' },
                    { source: 'process2', target: 'end' },
                    { source: 'process3', target: 'end' }
                ]
            },
            process: {
                name: 'Business Process',
                description: 'A business approval process with multiple decision points and feedback loops.',
                nodes: [
                    { id: 'start', label: 'Start Request', type: 'start', x: 200, y: 50 },
                    { id: 'input', label: 'Gather Info', type: 'input', x: 200, y: 130 },
                    { id: 'check', label: 'Complete?', type: 'decision', x: 200, y: 210 },
                    { id: 'review', label: 'Review', type: 'process', x: 350, y: 290 },
                    { id: 'approve', label: 'Approved?', type: 'decision', x: 350, y: 370 },
                    { id: 'process', label: 'Process', type: 'process', x: 500, y: 450 },
                    { id: 'reject', label: 'Send Notice', type: 'process', x: 200, y: 450 },
                    { id: 'end', label: 'End', type: 'end', x: 350, y: 530 }
                ],
                links: [
                    { source: 'start', target: 'input' },
                    { source: 'input', target: 'check' },
                    { source: 'check', target: 'review', label: 'Yes' },
                    { source: 'check', target: 'input', label: 'No' },
                    { source: 'review', target: 'approve' },
                    { source: 'approve', target: 'process', label: 'Yes' },
                    { source: 'approve', target: 'reject', label: 'No' },
                    { source: 'process', target: 'end' },
                    { source: 'reject', target: 'end' }
                ]
            },
            decision: {
                name: 'Decision Tree',
                description: 'A decision tree for customer support with multiple branching paths.',
                nodes: [
                    { id: 'inquiry', label: 'Customer Inquiry', type: 'start', x: 300, y: 50 },
                    { id: 'type', label: 'Issue Type?', type: 'decision', x: 300, y: 130 },
                    { id: 'tech', label: 'Technical Support', type: 'process', x: 150, y: 210 },
                    { id: 'billing', label: 'Billing Dept', type: 'process', x: 300, y: 210 },
                    { id: 'general', label: 'General Support', type: 'process', x: 450, y: 210 },
                    { id: 'complex', label: 'Complex?', type: 'decision', x: 150, y: 290 },
                    { id: 'simple', label: 'Provide Solution', type: 'process', x: 75, y: 370 },
                    { id: 'escalate', label: 'Escalate', type: 'process', x: 225, y: 370 },
                    { id: 'close', label: 'Close Ticket', type: 'end', x: 300, y: 450 }
                ],
                links: [
                    { source: 'inquiry', target: 'type' },
                    { source: 'type', target: 'tech', label: 'Tech' },
                    { source: 'type', target: 'billing', label: 'Billing' },
                    { source: 'type', target: 'general', label: 'General' },
                    { source: 'tech', target: 'complex' },
                    { source: 'complex', target: 'simple', label: 'No' },
                    { source: 'complex', target: 'escalate', label: 'Yes' },
                    { source: 'billing', target: 'close' },
                    { source: 'general', target: 'close' },
                    { source: 'simple', target: 'close' },
                    { source: 'escalate', target: 'close' }
                ]
            },
            workflow: {
                name: 'Software Workflow',
                description: 'A software development workflow with testing and deployment stages.',
                nodes: [
                    { id: 'req', label: 'Requirements', type: 'start', x: 100, y: 100 },
                    { id: 'design', label: 'Design', type: 'process', x: 250, y: 100 },
                    { id: 'dev', label: 'Development', type: 'process', x: 400, y: 100 },
                    { id: 'test', label: 'Testing', type: 'process', x: 400, y: 200 },
                    { id: 'pass', label: 'Tests Pass?', type: 'decision', x: 400, y: 300 },
                    { id: 'deploy', label: 'Deploy', type: 'process', x: 550, y: 400 },
                    { id: 'monitor', label: 'Monitor', type: 'process', x: 550, y: 500 },
                    { id: 'issues', label: 'Issues?', type: 'decision', x: 400, y: 500 },
                    { id: 'success', label: 'Success', type: 'end', x: 250, y: 500 }
                ],
                links: [
                    { source: 'req', target: 'design' },
                    { source: 'design', target: 'dev' },
                    { source: 'dev', target: 'test' },
                    { source: 'test', target: 'pass' },
                    { source: 'pass', target: 'deploy', label: 'Yes' },
                    { source: 'pass', target: 'dev', label: 'No' },
                    { source: 'deploy', target: 'monitor' },
                    { source: 'monitor', target: 'issues' },
                    { source: 'issues', target: 'success', label: 'No' },
                    { source: 'issues', target: 'dev', label: 'Yes' }
                ]
            }
        };

        // Initialize the chart
        function initChart() {
            const container = d3.select('#flowchart');
            const containerRect = container.node().getBoundingClientRect();
            
            svg = container
                .attr('width', containerRect.width)
                .attr('height', containerRect.height);

            // Add arrow marker
            svg.append('defs').append('marker')
                .attr('id', 'arrowhead')
                .attr('viewBox', '0 -5 10 10')
                .attr('refX', 8)
                .attr('refY', 0)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,-5L10,0L0,5')
                .attr('fill', '#666');

            // Add zoom behavior
            zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // Create main group
            g = svg.append('g');
        }

        // Load sample data
        function loadSampleData(type) {
            const data = sampleData[type];
            if (data) {
                currentData = data;
                document.getElementById('chartType').textContent = data.name;
                document.getElementById('datasetDescription').textContent = data.description;
                renderChart();
                updateStatistics();
            }
        }

        // Render the chart
        function renderChart() {
            if (!currentData) return;

            // Clear existing elements
            g.selectAll('*').remove();

            // Draw links first (so they appear behind nodes)
            const links = g.selectAll('.link')
                .data(currentData.links)
                .enter()
                .append('g')
                .attr('class', 'link-group');

            // Draw link paths
            links.append('path')
                .attr('class', 'link')
                .attr('d', d => {
                    const source = currentData.nodes.find(n => n.id === d.source);
                    const target = currentData.nodes.find(n => n.id === d.target);
                    return `M${source.x},${source.y} L${target.x},${target.y}`;
                });

            // Add link labels
            links.filter(d => d.label)
                .append('text')
                .attr('class', 'link-label')
                .attr('x', d => {
                    const source = currentData.nodes.find(n => n.id === d.source);
                    const target = currentData.nodes.find(n => n.id === d.target);
                    return (source.x + target.x) / 2;
                })
                .attr('y', d => {
                    const source = currentData.nodes.find(n => n.id === d.source);
                    const target = currentData.nodes.find(n => n.id === d.target);
                    return (source.y + target.y) / 2 - 5;
                })
                .text(d => d.label);

            // Draw nodes
            const nodes = g.selectAll('.node')
                .data(currentData.nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x},${d.y})`);

            // Add node shapes based on type
            nodes.each(function(d) {
                const node = d3.select(this);
                const colors = {
                    start: '#43e97b',
                    end: '#43e97b',
                    process: '#4facfe',
                    decision: '#f093fb',
                    input: '#fa709a'
                };

                if (d.type === 'decision') {
                    // Diamond shape for decisions
                    node.append('polygon')
                        .attr('class', 'node-diamond')
                        .attr('points', '-40,0 0,-25 40,0 0,25')
                        .attr('fill', colors[d.type]);
                } else if (d.type === 'start' || d.type === 'end') {
                    // Circle for start/end
                    node.append('circle')
                        .attr('class', 'node-circle')
                        .attr('r', 30)
                        .attr('fill', colors[d.type]);
                } else {
                    // Rectangle for process/input
                    node.append('rect')
                        .attr('class', 'node-rect')
                        .attr('x', -50)
                        .attr('y', -20)
                        .attr('width', 100)
                        .attr('height', 40)
                        .attr('fill', colors[d.type]);
                }

                // Add text
                node.append('text')
                    .attr('class', 'node-text')
                    .text(d.label)
                    .call(wrapText, 80);
            });

            // Add drag behavior to nodes
            nodes.call(d3.drag()
                .on('drag', function(event, d) {
                    d.x = event.x;
                    d.y = event.y;
                    d3.select(this).attr('transform', `translate(${d.x},${d.y})`);
                    
                    // Update connected links
                    updateLinks();
                }));
        }

        // Update link positions
        function updateLinks() {
            g.selectAll('.link')
                .attr('d', d => {
                    const source = currentData.nodes.find(n => n.id === d.source);
                    const target = currentData.nodes.find(n => n.id === d.target);
                    return `M${source.x},${source.y} L${target.x},${target.y}`;
                });

            g.selectAll('.link-label')
                .attr('x', d => {
                    const source = currentData.nodes.find(n => n.id === d.source);
                    const target = currentData.nodes.find(n => n.id === d.target);
                    return (source.x + target.x) / 2;
                })
                .attr('y', d => {
                    const source = currentData.nodes.find(n => n.id === d.source);
                    const target = currentData.nodes.find(n => n.id === d.target);
                    return (source.y + target.y) / 2 - 5;
                });
        }

        // Wrap text for long labels
        function wrapText(text, width) {
            text.each(function() {
                const text = d3.select(this);
                const words = text.text().split(/\s+/).reverse();
                let word;
                let line = [];
                let lineNumber = 0;
                const lineHeight = 1.1;
                const y = text.attr('y') || 0;
                const dy = 0;
                let tspan = text.text(null).append('tspan').attr('x', 0).attr('y', y).attr('dy', dy + 'em');
                
                while (word = words.pop()) {
                    line.push(word);
                    tspan.text(line.join(' '));
                    if (tspan.node().getComputedTextLength() > width) {
                        line.pop();
                        tspan.text(line.join(' '));
                        line = [word];
                        tspan = text.append('tspan').attr('x', 0).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                    }
                }
            });
        }

        // Add random node
        function addRandomNode() {
            if (!currentData) {
                loadSampleData('simple');
                return;
            }

            nodeCounter++;
            const newNode = {
                id: `node${nodeCounter}`,
                label: `New Node ${nodeCounter}`,
                type: 'process',
                x: Math.random() * 400 + 100,
                y: Math.random() * 400 + 100
            };

            currentData.nodes.push(newNode);

            // Connect to random existing node
            if (currentData.nodes.length > 1) {
                const randomNode = currentData.nodes[Math.floor(Math.random() * (currentData.nodes.length - 1))];
                currentData.links.push({
                    source: randomNode.id,
                    target: newNode.id
                });
            }

            renderChart();
            updateStatistics();
        }

        // Randomize data
        function randomizeData() {
            const types = Object.keys(sampleData);
            const randomType = types[Math.floor(Math.random() * types.length)];
            loadSampleData(randomType);
        }

        // Export chart as SVG
        function exportChart() {
            const svgElement = document.getElementById('flowchart');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
            const svgUrl = URL.createObjectURL(svgBlob);
            const downloadLink = document.createElement('a');
            downloadLink.href = svgUrl;
            downloadLink.download = 'flowchart.svg';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(svgUrl);
        }

        // Reset zoom
        function resetZoom() {
            svg.transition()
                .duration(750)
                .call(zoom.transform, d3.zoomIdentity);
        }

        // Update statistics
        function updateStatistics() {
            if (!currentData) return;
            
            document.getElementById('nodeCount').textContent = currentData.nodes.length;
            document.getElementById('connectionCount').textContent = currentData.links.length;
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            loadSampleData('simple');
            
            // Handle window resize
            window.addEventListener('resize', function() {
                const container = d3.select('#flowchart');
                const containerRect = container.node().getBoundingClientRect();
                svg.attr('width', containerRect.width).attr('height', containerRect.height);
            });
        });
    </script>
</body>
</html>
