<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Treemap Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            margin: 0 auto;
        }
                
        .chart-container {
            padding: 0px;
        }
        
        .treemap-container {
            padding: 0px;
        }
        
        .treemap-rect {
            stroke: white;
            stroke-width: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .treemap-rect:hover {
            stroke-width: 3px;
            stroke: #333;
            filter: brightness(1.1);
        }
        
        .treemap-text {
            font-size: 12px;
            font-weight: 500;
            fill: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .treemap-value {
            font-size: 10px;
            fill: rgba(255,255,255,0.8);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
        }
                
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .treemap-container {
                height: 400px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-container">
            <div class="treemap-container" id="treemap"></div>
        </div>
        
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        let currentData = null;
        let currentRoot = null;
        let svg, treemap, root;
        
        const width = 1000;
        const height = 600;
        
        // Color schemes for different categories
        const colorSchemes = {
            tech: d3.scaleOrdinal(d3.schemeSet3),
            sales: d3.scaleOrdinal(d3.schemeCategory10),
            portfolio: d3.scaleOrdinal(d3.schemePastel1),
            world: d3.scaleOrdinal(d3.schemeTableau10),
            random: d3.scaleOrdinal(d3.schemeSet2)
        };
        
        let currentColorScheme = colorSchemes.tech;
        
        // Sample datasets
        const sampleData = {
            tech: {
                name: "Tech Companies",
                children: [
                    {
                        name: "FAANG",
                        children: [
                            { name: "Apple", value: 2800, category: "Hardware" },
                            { name: "Microsoft", value: 2500, category: "Software" },
                            { name: "Alphabet", value: 1800, category: "Internet" },
                            { name: "Amazon", value: 1600, category: "E-commerce" },
                            { name: "Meta", value: 900, category: "Social" }
                        ]
                    },
                    {
                        name: "Other Tech",
                        children: [
                            { name: "Tesla", value: 800, category: "Automotive" },
                            { name: "Netflix", value: 200, category: "Streaming" },
                            { name: "Nvidia", value: 600, category: "Hardware" },
                            { name: "Adobe", value: 250, category: "Software" },
                            { name: "Salesforce", value: 220, category: "Software" }
                        ]
                    }
                ]
            },
        };
        
        function initializeTreemap() {
            const container = d3.select("#treemap");
            container.selectAll("*").remove();
            
            svg = container.append("svg")
                .attr("width", "100%")
                .attr("height", "100%")
                .attr("viewBox", `0 0 ${width} ${height}`)
                .style("font", "10px sans-serif");
            
            treemap = d3.treemap()
                .size([width, height])
                .padding(2)
                .round(true);
        }
        
        function updateTreemap(data, isRoot = true) {
            currentData = data;
            if (isRoot) {
                currentRoot = data;
            }
            
            root = d3.hierarchy(data)
                .sum(d => d.value || 0)
                .sort((a, b) => b.value - a.value);
            
            treemap(root);
            
            svg.selectAll("*").remove();
            
            const leaf = svg.selectAll("g")
                .data(root.leaves())
                .join("g")
                .attr("transform", d => `translate(${d.x0},${d.y0})`);
            
            leaf.append("rect")
                .attr("class", "treemap-rect")
                .attr("fill", d => currentColorScheme(d.data.category || d.parent.data.name))
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => d.y1 - d.y0)
                .on("mouseover", function(event, d) {
                    showTooltip(event, d);
                })
                .on("mousemove", function(event, d) {
                    moveTooltip(event);
                })
                .on("mouseout", function() {
                    hideTooltip();
                })
                .on("click", function(event, d) {
                    if (d.parent && d.parent.data.children) {
                        navigateToParent(d.parent.data);
                    }
                });
            
            leaf.append("text")
                .attr("class", "treemap-text")
                .attr("x", d => (d.x1 - d.x0) / 2)
                .attr("y", d => (d.y1 - d.y0) / 2 - 5)
                .text(d => d.data.name)
                .style("font-size", d => Math.min((d.x1 - d.x0) / 8, (d.y1 - d.y0) / 4, 14) + "px")
                .each(function(d) {
                    const textLength = this.getComputedTextLength();
                    const availableWidth = d.x1 - d.x0 - 4;
                    if (textLength > availableWidth) {
                        const text = d.data.name;
                        const ratio = availableWidth / textLength;
                        const maxLength = Math.floor(text.length * ratio) - 3;
                        d3.select(this).text(text.substring(0, maxLength) + "...");
                    }
                });
            
            leaf.append("text")
                .attr("class", "treemap-value")
                .attr("x", d => (d.x1 - d.x0) / 2)
                .attr("y", d => (d.y1 - d.y0) / 2 + 10)
                .text(d => formatValue(d.data.value))
                .style("font-size", d => Math.min((d.x1 - d.x0) / 10, (d.y1 - d.y0) / 6, 12) + "px");
            
            // Add parent group rectangles for navigation
            if (data.children) {
                const groups = svg.selectAll(".group-rect")
                    .data(root.children || [])
                    .join("rect")
                    .attr("class", "group-rect")
                    .attr("x", d => d.x0)
                    .attr("y", d => d.y0)
                    .attr("width", d => d.x1 - d.x0)
                    .attr("height", d => d.y1 - d.y0)
                    .attr("fill", "none")
                    .attr("stroke", "#333")
                    .attr("stroke-width", 3)
                    .attr("stroke-dasharray", "5,5")
                    .style("cursor", "pointer")
                    .on("click", function(event, d) {
                        if (d.data.children) {
                            navigateToChild(d.data);
                        }
                    });
                
                // Add group labels
                svg.selectAll(".group-label")
                    .data(root.children || [])
                    .join("text")
                    .attr("class", "group-label")
                    .attr("x", d => d.x0 + 5)
                    .attr("y", d => d.y0 + 15)
                    .text(d => d.data.name)
                    .style("font-size", "14px")
                    .style("font-weight", "bold")
                    .style("fill", "#333")
                    .style("pointer-events", "none");
            }
            
        }
        
        function navigateToChild(childData) {
            updateTreemap(childData, false);
        }
        
        function navigateToParent(parentData) {
            updateTreemap(parentData, false);
        }
        
        function navigateToRoot() {
            if (currentRoot) {
                updateTreemap(currentRoot, true);
            }
        }
                
        function loadSampleData(type) {
            currentColorScheme = colorSchemes[type];
            updateTreemap(sampleData[type]);
        }
        
        function generateRandomData() {
            const categories = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon'];
            const data = {
                name: "Random Data",
                children: []
            };
            
            for (let i = 0; i < 3; i++) {
                const group = {
                    name: `Group ${i + 1}`,
                    children: []
                };
                
                for (let j = 0; j < Math.floor(Math.random() * 5) + 3; j++) {
                    group.children.push({
                        name: `Item ${i}-${j}`,
                        value: Math.floor(Math.random() * 500) + 50,
                        category: categories[Math.floor(Math.random() * categories.length)]
                    });
                }
                
                data.children.push(group);
            }
            
            currentColorScheme = colorSchemes.random;
            updateTreemap(data);
        }
        
        function resetZoom() {
            navigateToRoot();
        }
        
        function exportSVG() {
            const svgElement = document.querySelector("#treemap svg");
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgElement);
            
            const blob = new Blob([svgString], { type: "image/svg+xml" });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.href = url;
            link.download = "treemap.svg";
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        function showTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <strong>${d.data.name}</strong><br>
                Value: ${formatValue(d.data.value)}<br>
                Category: ${d.data.category || 'N/A'}<br>
                Percentage: ${((d.data.value / root.value) * 100).toFixed(1)}%
            `;
            tooltip.style.opacity = 1;
            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 0;
        }
        
        function formatValue(value) {
            if (value >= 1000000) {
                return (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return (value / 1000).toFixed(1) + 'K';
            }
            return value.toString();
        }
                
        // Initialize the treemap
        initializeTreemap();
        loadSampleData('tech');
    </script>
</body>
</html>
