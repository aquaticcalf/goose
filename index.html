<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Graph Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            resize: vertical;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .sample-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .sample-buttons button {
            background-color: #2196F3;
        }
        
        .sample-buttons button:hover {
            background-color: #1976D2;
        }
        
        #graph {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .node {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 2px;
        }
        
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        
        .node-label {
            font-size: 12px;
            text-anchor: middle;
            pointer-events: none;
            fill: #333;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .error {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Interactive Graph Visualization</h1>
        
        <div class="controls">
            <div style="width: 100%;">
                <label for="jsonInput"><strong>Graph Data (JSON):</strong></label>
                <div class="sample-buttons">
                    <button onclick="loadSampleData('simple')">Load Simple Graph</button>
                    <button onclick="loadSampleData('complex')">Load Complex Graph</button>
                    <button onclick="loadSampleData('network')">Load Network Graph</button>
                </div>
                <textarea id="jsonInput" placeholder="Enter your graph data in JSON format..."></textarea>
                <div style="margin-top: 10px;">
                    <button onclick="renderGraph()">Render Graph</button>
                    <button onclick="clearGraph()">Clear</button>
                </div>
                <div id="error-message"></div>
            </div>
        </div>
        
        <svg id="graph" width="100%" height="600"></svg>
        <div class="tooltip" id="tooltip"></div>
    </div>

    <script>
        // Sample data sets
        const sampleData = {
            simple: {
                nodes: [
                    { id: "A", name: "Node A", group: 1 },
                    { id: "B", name: "Node B", group: 1 },
                    { id: "C", name: "Node C", group: 2 },
                    { id: "D", name: "Node D", group: 2 }
                ],
                links: [
                    { source: "A", target: "B", value: 1 },
                    { source: "B", target: "C", value: 2 },
                    { source: "C", target: "D", value: 1 },
                    { source: "D", target: "A", value: 3 }
                ]
            },
            complex: {
                nodes: [
                    { id: "central", name: "Central Hub", group: 1, size: 20 },
                    { id: "node1", name: "Service A", group: 2, size: 15 },
                    { id: "node2", name: "Service B", group: 2, size: 15 },
                    { id: "node3", name: "Database", group: 3, size: 18 },
                    { id: "node4", name: "API Gateway", group: 4, size: 12 },
                    { id: "node5", name: "Cache", group: 3, size: 10 },
                    { id: "node6", name: "Load Balancer", group: 4, size: 14 }
                ],
                links: [
                    { source: "central", target: "node1", value: 5, type: "strong" },
                    { source: "central", target: "node2", value: 3, type: "medium" },
                    { source: "node1", target: "node3", value: 4, type: "strong" },
                    { source: "node2", target: "node3", value: 2, type: "weak" },
                    { source: "node4", target: "central", value: 6, type: "strong" },
                    { source: "node5", target: "node1", value: 2, type: "weak" },
                    { source: "node6", target: "node4", value: 4, type: "medium" }
                ]
            },
            network: {
                nodes: [
                    { id: "user1", name: "Alice", group: 1 },
                    { id: "user2", name: "Bob", group: 1 },
                    { id: "user3", name: "Charlie", group: 2 },
                    { id: "user4", name: "Diana", group: 2 },
                    { id: "user5", name: "Eve", group: 3 },
                    { id: "user6", name: "Frank", group: 3 },
                    { id: "user7", name: "Grace", group: 1 },
                    { id: "user8", name: "Henry", group: 2 }
                ],
                links: [
                    { source: "user1", target: "user2", value: 1 },
                    { source: "user1", target: "user3", value: 2 },
                    { source: "user2", target: "user4", value: 1 },
                    { source: "user3", target: "user5", value: 3 },
                    { source: "user4", target: "user6", value: 1 },
                    { source: "user5", target: "user7", value: 2 },
                    { source: "user6", target: "user8", value: 1 },
                    { source: "user7", target: "user1", value: 1 },
                    { source: "user8", target: "user3", value: 2 }
                ]
            }
        };

        // Graph variables
        let svg, simulation, link, node, nodeLabels;
        const width = 1000;
        const height = 600;

        // Color scale
        const color = d3.scaleOrdinal(d3.schemeCategory10);

        // Initialize SVG
        function initializeSVG() {
            svg = d3.select("#graph")
                .attr("width", width)
                .attr("height", height);
            
            svg.selectAll("*").remove(); // Clear previous content
        }

        // Load sample data
        function loadSampleData(type) {
            const data = sampleData[type];
            document.getElementById('jsonInput').value = JSON.stringify(data, null, 2);
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => {
                errorDiv.innerHTML = '';
            }, 5000);
        }

        // Render the graph
        function renderGraph() {
            const jsonInput = document.getElementById('jsonInput').value.trim();
            
            if (!jsonInput) {
                showError('Please enter JSON data or load a sample.');
                return;
            }

            let data;
            try {
                data = JSON.parse(jsonInput);
            } catch (e) {
                showError('Invalid JSON format. Please check your data.');
                return;
            }

            if (!data.nodes || !data.links) {
                showError('JSON must contain "nodes" and "links" arrays.');
                return;
            }

            initializeSVG();
            drawGraph(data);
        }

        // Draw the graph
        function drawGraph(data) {
            // Create simulation
            simulation = d3.forceSimulation(data.nodes)
                .force("link", d3.forceLink(data.links).id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(30));

            // Create links
            link = svg.append("g")
                .selectAll("line")
                .data(data.links)
                .enter().append("line")
                .attr("class", "link")
                .style("stroke-width", d => Math.sqrt(d.value || 1) * 2)
                .style("stroke", d => {
                    if (d.type === "strong") return "#ff6b6b";
                    if (d.type === "medium") return "#4ecdc4";
                    if (d.type === "weak") return "#95e1d3";
                    return "#999";
                });

            // Create nodes
            node = svg.append("g")
                .selectAll("circle")
                .data(data.nodes)
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", d => d.size || 10)
                .style("fill", d => color(d.group))
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended))
                .on("mouseover", function(event, d) {
                    showTooltip(event, d);
                })
                .on("mouseout", hideTooltip)
                .on("click", function(event, d) {
                    console.log("Clicked node:", d);
                });

            // Create node labels
            nodeLabels = svg.append("g")
                .selectAll("text")
                .data(data.nodes)
                .enter().append("text")
                .attr("class", "node-label")
                .text(d => d.name || d.id)
                .attr("dy", d => (d.size || 10) + 15);

            // Update positions on simulation tick
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("cx", d => d.x)
                    .attr("cy", d => d.y);

                nodeLabels
                    .attr("x", d => d.x)
                    .attr("y", d => d.y);
            });
        }

        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Tooltip functions
        function showTooltip(event, d) {
            const tooltip = d3.select("#tooltip");
            tooltip.style("opacity", 1)
                .html(`
                    <strong>${d.name || d.id}</strong><br/>
                    Group: ${d.group}<br/>
                    ${d.size ? `Size: ${d.size}<br/>` : ''}
                    ${Object.keys(d).filter(key => !['id', 'name', 'group', 'size', 'x', 'y', 'vx', 'vy', 'fx', 'fy'].includes(key)).map(key => `${key}: ${d[key]}`).join('<br/>')}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function hideTooltip() {
            d3.select("#tooltip").style("opacity", 0);
        }

        // Clear graph
        function clearGraph() {
            if (svg) {
                svg.selectAll("*").remove();
            }
            if (simulation) {
                simulation.stop();
            }
        }

        // Load simple sample on page load
        window.onload = function() {
            loadSampleData('simple');
        };
    </script>
</body>
</html>
